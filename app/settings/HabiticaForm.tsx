'use client';

import CommonButton from '@/app/_components/CommonButton';
import { Button, ButtonGroup, Input } from '@nextui-org/react';
import clsx from 'clsx';
import { useCallback, useState } from 'react';

const eyeIcon = (
  <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M0 8C0 9.64 0.425 10.191 1.275 11.296C2.972 13.5 5.818 16 10 16C14.182 16 17.028 13.5 18.725 11.296C19.575 10.192 20 9.639 20 8C20 6.36 19.575 5.809 18.725 4.704C17.028 2.5 14.182 0 10 0C5.818 0 2.972 2.5 1.275 4.704C0.425 5.81 0 6.361 0 8ZM10 4.25C9.00544 4.25 8.05161 4.64509 7.34835 5.34835C6.64509 6.05161 6.25 7.00544 6.25 8C6.25 8.99456 6.64509 9.94839 7.34835 10.6517C8.05161 11.3549 9.00544 11.75 10 11.75C10.9946 11.75 11.9484 11.3549 12.6517 10.6517C13.3549 9.94839 13.75 8.99456 13.75 8C13.75 7.00544 13.3549 6.05161 12.6517 5.34835C11.9484 4.64509 10.9946 4.25 10 4.25Z"
      fill="white"
    />
  </svg>
);

const closedEyeIcon = (
  <svg width="20" height="12" viewBox="0 0 20 12" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M0.500001 2C0.499628 1.63723 0.63074 1.28661 0.869052 1.01309C1.10736 0.739571 1.43673 0.561685 1.79614 0.51238C2.15555 0.463076 2.52065 0.545695 2.82381 0.744934C3.12698 0.944173 3.34767 1.24653 3.445 1.596C5.392 8.098 14.603 8.099 16.554 1.601C16.6088 1.41096 16.7007 1.23364 16.8243 1.07924C16.9479 0.924838 17.1009 0.796413 17.2743 0.701355C17.4478 0.606296 17.6383 0.546481 17.835 0.525351C18.0317 0.504222 18.2305 0.522196 18.4202 0.578238C18.6099 0.634281 18.7867 0.727285 18.9403 0.851899C19.0939 0.976513 19.2213 1.13028 19.3152 1.30433C19.4092 1.47839 19.4678 1.66932 19.4876 1.86611C19.5075 2.0629 19.4883 2.26168 19.431 2.451C19.0893 3.61862 18.5395 4.71489 17.808 5.687L18.768 6.647C18.9112 6.78544 19.0254 6.95101 19.1039 7.13406C19.1824 7.3171 19.2237 7.51395 19.2254 7.71312C19.227 7.91229 19.189 8.10979 19.1134 8.29409C19.0379 8.4784 18.9265 8.64583 18.7856 8.7866C18.6447 8.92737 18.4771 9.03867 18.2928 9.114C18.1084 9.18934 17.9108 9.2272 17.7117 9.22537C17.5125 9.22355 17.3157 9.18208 17.1327 9.10338C16.9498 9.02468 16.7843 8.91033 16.646 8.767L15.636 7.757C15.111 8.1166 14.5516 8.4231 13.966 8.672L14.209 9.578C14.3012 9.95857 14.2409 10.3601 14.041 10.6968C13.8411 11.0335 13.5175 11.2787 13.1393 11.38C12.761 11.4814 12.3582 11.4308 12.0167 11.239C11.6753 11.0473 11.4224 10.7297 11.312 10.354L11.061 9.419C10.356 9.492 9.644 9.492 8.939 9.419L8.689 10.354C8.5861 10.7383 8.33475 11.066 7.99024 11.265C7.64574 11.4639 7.2363 11.5179 6.852 11.415C6.4677 11.3121 6.14002 11.0607 5.94105 10.7162C5.74207 10.3717 5.6881 9.9623 5.791 9.578L6.033 8.671C5.44777 8.42236 4.88869 8.11619 4.364 7.757L3.354 8.767C3.2157 8.91033 3.05023 9.02468 2.86727 9.10338C2.6843 9.18208 2.48749 9.22355 2.28832 9.22537C2.08915 9.2272 1.89162 9.18934 1.70724 9.114C1.52286 9.03867 1.35533 8.92737 1.21442 8.7866C1.07352 8.64583 0.962061 8.4784 0.886553 8.29409C0.811044 8.10979 0.772999 7.91229 0.774635 7.71312C0.776271 7.51395 0.817556 7.3171 0.896082 7.13406C0.974608 6.95101 1.0888 6.78544 1.232 6.647L2.192 5.687C1.46223 4.71648 0.913444 3.6223 0.572001 2.457C0.524512 2.30931 0.500223 2.15514 0.500001 2Z"
      fill="white"
    />
  </svg>
);

const checkIcon = (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM9.29 16.29L5.7 12.7C5.60742 12.6074 5.53398 12.4975 5.48387 12.3765C5.43377 12.2556 5.40798 12.1259 5.40798 11.995C5.40798 11.8641 5.43377 11.7344 5.48387 11.6135C5.53398 11.4925 5.60742 11.3826 5.7 11.29C5.79258 11.1974 5.90249 11.124 6.02346 11.0739C6.14442 11.0238 6.27407 10.998 6.405 10.998C6.53593 10.998 6.66558 11.0238 6.78654 11.0739C6.90751 11.124 7.01742 11.1974 7.11 11.29L10 14.17L16.88 7.29C17.067 7.10302 17.3206 6.99798 17.585 6.99798C17.8494 6.99798 18.103 7.10302 18.29 7.29C18.477 7.47698 18.582 7.73057 18.582 7.995C18.582 8.25943 18.477 8.51302 18.29 8.7L10.7 16.29C10.6075 16.3827 10.4976 16.4563 10.3766 16.5064C10.2557 16.5566 10.126 16.5824 9.995 16.5824C9.86403 16.5824 9.73435 16.5566 9.61338 16.5064C9.4924 16.4563 9.38251 16.3827 9.29 16.29Z"
      fill="white"
    />
  </svg>
);

const xIcon = (
  <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M11.5 22.4375C14.4008 22.4375 17.1828 21.2852 19.234 19.234C21.2852 17.1828 22.4375 14.4008 22.4375 11.5C22.4375 8.59919 21.2852 5.8172 19.234 3.76602C17.1828 1.71484 14.4008 0.5625 11.5 0.5625C8.59919 0.5625 5.8172 1.71484 3.76602 3.76602C1.71484 5.8172 0.5625 8.59919 0.5625 11.5C0.5625 14.4008 1.71484 17.1828 3.76602 19.234C5.8172 21.2852 8.59919 22.4375 11.5 22.4375ZM15.8437 15.8437C15.624 16.0632 15.3262 16.1865 15.0156 16.1865C14.7051 16.1865 14.4072 16.0632 14.1875 15.8437L11.5 13.1563L8.8125 15.8437C8.70522 15.9589 8.57584 16.0512 8.43209 16.1153C8.28834 16.1793 8.13316 16.2138 7.97582 16.2165C7.81847 16.2193 7.66217 16.1904 7.51625 16.1314C7.37033 16.0725 7.23778 15.9848 7.1265 15.8735C7.01522 15.7622 6.9275 15.6297 6.86856 15.4837C6.80962 15.3378 6.78067 15.1815 6.78345 15.0242C6.78623 14.8668 6.82067 14.7117 6.88472 14.5679C6.94877 14.4242 7.04111 14.2948 7.15625 14.1875L9.84375 11.5L7.15625 8.8125C6.94925 8.59035 6.83656 8.29653 6.84191 7.99293C6.84727 7.68934 6.97026 7.39967 7.18497 7.18497C7.39967 6.97026 7.68934 6.84727 7.99293 6.84191C8.29653 6.83656 8.59035 6.94925 8.8125 7.15625L11.5 9.84375L14.1875 7.15625C14.2948 7.04111 14.4242 6.94877 14.5679 6.88472C14.7117 6.82067 14.8668 6.78623 15.0242 6.78345C15.1815 6.78067 15.3378 6.80962 15.4837 6.86856C15.6297 6.9275 15.7622 7.01522 15.8735 7.1265C15.9848 7.23778 16.0725 7.37033 16.1314 7.51625C16.1904 7.66217 16.2193 7.81847 16.2165 7.97582C16.2138 8.13316 16.1793 8.28834 16.1153 8.43209C16.0512 8.57584 15.9589 8.70522 15.8437 8.8125L13.1563 11.5L15.8437 14.1875C16.0632 14.4072 16.1865 14.7051 16.1865 15.0156C16.1865 15.3262 16.0632 15.624 15.8437 15.8437Z"
      fill="white"
    />
  </svg>
);

export default function HabiticaForm() {
  const [editMode, setEditMode] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [error, setError] = useState<object | null>(null);

  const edit = useCallback(() => {
    setEditMode(true);
    setError(null);
  }, []);
  const save = useCallback(() => {
    setEditMode(false);
    setShowPassword(false);
  }, []);
  const cancel = useCallback(() => {
    setEditMode(false);
    setShowPassword(false);
  }, []);
  const togglePassword = useCallback(() => setShowPassword((prev) => !prev), []);

  return (
    <>
      <h2>Habitica</h2>
      <Input variant={editMode ? 'faded' : 'bordered'} label="User ID" isDisabled={!editMode} isInvalid={!!error} />
      <Input
        variant={editMode ? 'faded' : 'bordered'}
        label="API Key"
        isDisabled={!editMode}
        type={showPassword ? 'text' : 'password'}
        endContent={
          <Button onClick={togglePassword} isIconOnly>
            {showPassword ? eyeIcon : closedEyeIcon}
          </Button>
        }
        isInvalid={!!error}
        errorMessage="Could not link to Habitica. Please check your User ID and API Key."
      />
      <div className="self-end flex gap-1">
        <CommonButton className={clsx(editMode && 'hidden')} onClick={edit}>
          Edit
        </CommonButton>
        <CommonButton className={clsx(editMode || 'hidden')} onClick={cancel} color="danger">
          Cancel
        </CommonButton>
        <CommonButton className={clsx(editMode || 'hidden')} onClick={save}>
          Save
        </CommonButton>
      </div>
    </>
  );
}
